(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var c=n(26),o=n(11),r=(n(35),n(36),n(37),n(38),n(13)),a=n(8),i=n(5),l=n(0),s=n.n(l),u=n(3),d="https://mate.academy/students-api";function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),fetch(d+e,c).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var b,f=function(e){return j(e)},m=function(e,t){return j(e,"POST",t)},O=function(e,t){return j(e,"PATCH",t)},p=function(e){return j(e,"DELETE")},h=function(e,t){return O("/todos/".concat(e),t)},x=n(4),v=n.n(x),g=n(7),N=function(){var e=Object(g.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=n(2),T=function(e){var t=e.onLogin,n=Object(l.useState)(""),c=Object(i.a)(n,2),o=c[0],r=c[1],a=Object(l.useState)(""),s=Object(i.a)(a,2),u=s[0],d=s[1],j=Object(l.useState)(!1),b=Object(i.a)(j,2),f=b[0],O=b[1],p=Object(l.useState)(""),h=Object(i.a)(p,2),x=h[0],v=h[1],g=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(l.useEffect)((function(){var e=localStorage.getItem("user");if(e){var n=JSON.parse(e);t(n)}}),[]);var T=function(){return function(e){var t=e.email,n=e.name;return m("/users",{email:t,name:n})}({name:u,email:o}).then(g).catch((function(){return v("Something went wrong")}))};return Object(y.jsxs)("form",{onSubmit:function(e){e.preventDefault(),v(""),f?T():N(o).then((function(e){e?g(e):O(!0)})).catch((function(){return v("Something went wrong")}))},className:"form",children:[Object(y.jsx)("h1",{className:"title",children:f?"You need to register":"Log in to open todos"}),Object(y.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(y.jsx)("div",{children:Object(y.jsx)("input",{type:"email",id:"user-email",className:"input",placeholder:"Enter your email",value:o,required:!0,onChange:function(e){return r(e.target.value)}})}),!f&&x&&Object(y.jsx)("p",{className:"error-message",children:x}),f&&Object(y.jsxs)("div",{children:[Object(y.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(y.jsx)("div",{children:Object(y.jsx)("input",{type:"text",id:"user-name",className:"input",placeholder:"Enter your name",required:!0,minLength:4,value:u,onChange:function(e){return d(e.target.value)}})}),f&&x&&Object(y.jsx)("p",{className:"error-message",children:x})]}),Object(y.jsx)("div",{className:"button-wrapper",children:Object(y.jsx)("button",{type:"submit",className:"form-button",children:f?"Register":"Login"})})]})},S=s.a.createContext(null),C=function(e){var t=e.children,n=Object(l.useState)(null),c=Object(i.a)(n,2),o=c[0],r=c[1];return o?Object(y.jsx)(S.Provider,{value:o,children:t}):Object(y.jsx)(T,{onLogin:r})},E=n(12),k=n.n(E),w=function(e){var t=e.errorText;return Object(y.jsx)("div",{className:k()("notification",{"notification-hidden":!t}),children:t})};!function(e){e.All="all",e.Active="active",e.Completed="completed"}(b||(b={}));var A=function(){var e=Object(u.l)("/:filterOption");return Object(y.jsxs)("ul",{className:"filters",children:[Object(y.jsx)("li",{children:Object(y.jsx)(o.b,{to:"../",className:k()({selected:!(null===e||void 0===e?void 0:e.params.filterOption)}),children:"All"})}),Object(y.jsx)("li",{children:Object(y.jsx)(o.b,{to:"../active",className:k()({selected:(null===e||void 0===e?void 0:e.params.filterOption)===b.Active}),children:"Active"})}),Object(y.jsx)("li",{children:Object(y.jsx)(o.b,{to:"../completed",className:k()({selected:(null===e||void 0===e?void 0:e.params.filterOption)===b.Completed}),children:"Completed"})})]})},D=function(e){var t=e.numberOfActiveTodos,n=e.numberOfCompletedTodos,c=e.todos,o=e.deleteTodo;return Object(y.jsxs)("footer",{className:"footer",children:[Object(y.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(t," items left")}),Object(y.jsx)(A,{}),!!n&&Object(y.jsx)("button",{type:"button",className:"clear-completed",onClick:function(){Promise.all(c.filter((function(e){return e.completed})).map((function(e){return o(e.id)})))},children:"Clear completed"})]})},I=function(e){var t=e.addTodo,n=e.addErrorMessage,c=e.setErrorText,o=Object(l.useContext)(S),a=Object(l.useRef)(null),s=Object(l.useState)(""),u=Object(i.a)(s,2),d=u[0],j=u[1];Object(l.useEffect)((function(){a.current&&a.current.focus()}),[]);return Object(y.jsxs)("header",{className:"header",children:[Object(y.jsx)("h1",{children:"todos"}),Object(y.jsx)("form",{onSubmit:function(e){var a,i;(e.preventDefault(),d.trim())?d.trim()&&o&&(c(""),(a=d,i=o.id,m("/todos",{userId:i,title:a,completed:!1})).then((function(e){t(Object(r.a)({},e))})).catch((function(){n("Unable to add a todo")})).finally((function(){j("")}))):n("Title can't be empty")},children:Object(y.jsx)("input",{type:"text","data-cy":"createTodo",className:"new-todo",placeholder:"What needs to be done?",ref:a,value:d,onChange:function(e){return j(e.target.value)}})})]})},J=function(e){var t=e.todo,n=e.deleteTodo,c=e.updateTodoData,o=Object(l.useRef)(null);Object(l.useEffect)((function(){o.current&&o.current.focus()}));var r=Object(l.useState)(!1),a=Object(i.a)(r,2),s=a[0],u=a[1],d=Object(l.useState)(t.title),j=Object(i.a)(d,2),b=j[0],f=j[1],m=function(){u(!1),b.trim()!==t.title&&(b.trim()?c(t.id,{title:b}):n(t.id))};return Object(y.jsxs)("li",{className:k()({completed:t.completed,editing:s}),children:[Object(y.jsxs)("div",{className:"view",children:[Object(y.jsx)("input",{type:"checkbox",className:"toggle",id:"toggle-view",checked:t.completed,onChange:function(){c(t.id,{completed:!t.completed})}}),Object(y.jsx)("label",{onDoubleClick:function(){return u(!0)},children:t.title}),Object(y.jsx)("button",{type:"button",className:"destroy","data-cy":"deleteTodo",onClick:function(){return n(t.id)}})]}),Object(y.jsx)("input",{type:"text",className:"edit",placeholder:"Empty todo will be deleted",ref:o,value:b,onChange:function(e){f(e.target.value)},onBlur:function(){m()},onKeyUp:function(e){"Escape"===e.key&&(u(!1),f(t.title)),"Enter"===e.key&&m()}})]})},L=function(e){var t=e.todos,n=e.deleteTodo,c=e.updateTodoData,o=Object(u.p)().filterOption,r=void 0===o?b.All:o,a=t.filter((function(e){switch(r){case b.Active:return!e.completed;case b.Completed:return e.completed;default:return t}}));return Object(y.jsx)("ul",{className:"todo-list","data-cy":"todoList",children:a.map((function(e){return Object(y.jsx)(J,{todo:e,deleteTodo:n,updateTodoData:c},e.id)}))})},U=function(){var e=Object(l.useContext)(S),t=localStorage.getItem("todos"),n=t?JSON.parse(t):[],c=Object(l.useState)(n),o=Object(i.a)(c,2),s=o[0],d=o[1],j=Object(l.useState)(""),b=Object(i.a)(j,2),m=b[0],O=b[1],x=function(e){O(e),setTimeout((function(){return O("")}),3e3)};Object(l.useEffect)((function(){var t;e&&(t=e.id,f("/todos?userId=".concat(t))).then(d)}),[]);var v=function(e){(function(e){return p("/todos/".concat(e))})(e).then((function(){d((function(t){return t.filter((function(t){return t.id!==e}))}))})).catch((function(){x("Unable to delete a todo")}))},g=function(e,t){h(e,t).then((function(){d(s.map((function(n){return n.id!==e?n:Object(r.a)(Object(r.a)({},n),t)})))})).catch((function(){x("Unable to update a todo")}))};Object(l.useEffect)((function(){localStorage.setItem("todos",JSON.stringify(s))}),[s]);var N=s.filter((function(e){return e.completed})).length,T=s.filter((function(e){return!e.completed})).length,C=Object(l.useMemo)((function(){return N===s.length}),[N]);return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)("div",{className:"todoapp",children:[Object(y.jsx)(I,{addTodo:function(e){d((function(t){return[].concat(Object(a.a)(t),[e])}))},addErrorMessage:x,setErrorText:O}),Object(y.jsxs)("section",{className:"main",children:[Object(y.jsx)("input",{type:"checkbox",id:"toggle-all",className:"toggle-all","data-cy":"toggleAll",checked:C,onChange:function(){Promise.all(s.filter((function(e){return e.completed===C})).map((function(e){return h(e.id,{completed:!C}).then((function(){d(s.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{completed:!C})})))})).catch((function(){x("Unable to update a todo")}))})))}}),Object(y.jsx)("label",{htmlFor:"toggle-all",children:"Mark all as complete"}),Object(y.jsx)(u.c,{children:Object(y.jsxs)(u.a,{path:"/",children:[Object(y.jsx)(u.a,{index:!0,element:Object(y.jsx)(L,{todos:s,deleteTodo:v,updateTodoData:g})}),Object(y.jsx)(u.a,{path:":filterOption",element:Object(y.jsx)(L,{todos:s,deleteTodo:v,updateTodoData:g})})]})})]}),s.length>0&&Object(y.jsx)(D,{numberOfActiveTodos:T,numberOfCompletedTodos:N,todos:s,deleteTodo:v})]}),m.length>0&&Object(y.jsx)(w,{errorText:m})]})};Object(c.createRoot)(document.getElementById("root")).render(Object(y.jsx)(o.a,{children:Object(y.jsx)(C,{children:Object(y.jsx)(U,{})})}))}},[[41,1,2]]]);
//# sourceMappingURL=main.bdd884d7.chunk.js.map